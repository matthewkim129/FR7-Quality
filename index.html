<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FR7 일일 품질개선 보고</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .thin-scroll::-webkit-scrollbar{width:8px;height:8px}
    .thin-scroll::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:6px}
    .thin-scroll::-webkit-scrollbar-track{background:transparent}
    .drag-over{outline:2px dashed #60a5fa; outline-offset:4px}
    table.calendar {border-collapse: collapse; width: 100%;}
    table.calendar th, table.calendar td {border: 1px solid #e2e8f0; text-align: center; padding: 4px; font-size: 12px;}
    table.calendar td.marked {background-color:#bfdbfe; font-weight:bold;}
  </style>
</head>
<body class="h-full bg-slate-50 text-slate-900">
  <div id="app" class="h-full flex">
    <aside class="w-80 bg-white border-r border-slate-200 flex flex-col">
      <div class="p-4 border-b flex items-center justify-between">
        <h1 class="text-lg font-bold">FR7 일일 보고</h1>
      </div>
      <div class="p-3 border-b space-y-2">
        <button id="newReportBtn" class="w-full py-2 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700">+ 새 보고서</button>
        <div class="flex gap-2">
          <button id="exportJsonBtn" class="flex-1 py-2 rounded-xl bg-emerald-600 text-white text-sm hover:bg-emerald-700">JSON 내보내기</button>
          <label class="flex-1">
            <input id="importJsonInput" type="file" accept="application/json" class="hidden">
            <span class="block text-center py-2 rounded-xl bg-amber-600 text-white text-sm hover:bg-amber-700">가져오기</span>
          </label>
        </div>
        <button id="printBtn" class="w-full py-2 rounded-xl bg-slate-700 text-white text-sm hover:bg-slate-800">인쇄 / PDF</button>
      </div>

      <div id="reportList" class="flex-1 overflow-y-auto thin-scroll divide-y"></div>
      <div class="p-3 border-t">
        <h2 class="text-sm font-semibold mb-2">달력</h2>
        <div id="calendarContainer"></div>
      </div>
      <div class="p-3 text-xs text-slate-400 border-t">
        로컬 저장소(LocalStorage/IndexedDB)에 저장됩니다.
      </div>
    </aside>

    <main class="flex-1 overflow-hidden">
      <div class="px-5 py-3 bg-white border-b flex items-center gap-3">
        <input id="reportTitle" class="text-lg font-bold flex-1 outline-none bg-transparent" placeholder="보고서 제목 (예: 2025-08-27 FR7 품질개선 일일 보고)" />
        <div id="autosaveState" class="text-xs text-slate-500">저장 상태: -</div>
      </div>

      <div class="px-5 pt-4 bg-white border-b">
        <div class="flex gap-2 text-sm">
          <button data-tab="tab-summary" class="tab-btn px-3 py-2 rounded-t bg-slate-100 font-semibold">요약</button>
          <button data-tab="tab-detail" class="tab-btn px-3 py-2 rounded-t">세부</button>
        </div>
      </div>

      <!-- 요약 -->
      <section id="tab-summary" class="tab-pane p-5 overflow-y-auto thin-scroll h-[calc(100vh-136px)]">
        <div class="bg-white rounded-xl shadow p-4">
          <h2 class="font-semibold mb-3">오늘의 요약</h2>
          <textarea id="summary" class="w-full min-h-40 rounded border p-3 text-sm" placeholder="핵심 목표, 주요 변경점, 결과 개요"></textarea>
        </div>
      </section>

      <!-- 세부 (과정, 결과·측정, 캡처, 영상 비교) -->
      <section id="tab-detail" class="tab-pane hidden p-5 overflow-y-auto thin-scroll h-[calc(100vh-136px)]">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <div class="bg-white rounded-xl shadow p-4">
            <h2 class="font-semibold mb-2">과정</h2>
            <textarea id="process" class="w-full min-h-40 rounded border p-3 text-sm" placeholder="이전 진행 사항, 수정/시도한 것, 새롭게 알게 된 점, 문제 & 해결"></textarea>
          </div>
          <div class="bg-white rounded-xl shadow p-4">
            <h2 class="font-semibold mb-2">결과·측정</h2>
            <textarea id="results" class="w-full min-h-40 rounded border p-3 text-sm" placeholder="수치 기록, 결과 요약, 다음 액션"></textarea>
          </div>
          <div class="bg-white rounded-xl shadow p-4 lg:col-span-2">
            <h2 class="font-semibold mb-2">캡처</h2>
            <div id="imgGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
          </div>
          <div class="bg-white rounded-xl shadow p-4 lg:col-span-2">
            <h2 class="font-semibold mb-2">영상 비교</h2>
            <video id="vidA" class="w-full rounded bg-black mb-2" controls></video>
            <video id="vidB" class="w-full rounded bg-black" controls></video>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    function renderCalendar(){
      const container = document.getElementById('calendarContainer');
      if(!container) return;
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month+1, 0);
      let html = '<table class="calendar"><thead><tr>';
      const days = ['일','월','화','수','목','금','토'];
      for(const d of days) html += '<th>'+d+'</th>';
      html += '</tr></thead><tbody><tr>';
      for(let i=0;i<firstDay.getDay();i++){ html+='<td></td>'; }
      for(let d=1;d<=lastDay.getDate();d++){
        const dateStr = year+'-'+String(month+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
        const marked = state.reports.some(r=>(r.dateKST||'').startsWith(dateStr));
        html += '<td class="'+(marked?'marked':'')+'">'+d+'</td>';
        if((firstDay.getDay()+d)%7===0) html+='</tr><tr>';
      }
      html += '</tr></tbody></table>';
      container.innerHTML = html;
    }

    const origSave = saveState;
    saveState = function(){ origSave(); renderCalendar(); };

    function boot(){
      loadState();
      if(!state.reports.length){
        const r = createEmptyReport();
        state.reports.push(r); state.currentId = r.id; saveState();
      }else if(!state.currentId){
        state.currentId = state.reports[0].id; saveState();
      }
      renderReportList();
      bindInputs();
      renderEditor();
      renderCalendar();
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
