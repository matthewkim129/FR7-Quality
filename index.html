<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FR7 일일 품질개선 보고</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .thin-scroll::-webkit-scrollbar{width:8px;height:8px}
    .thin-scroll::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:6px}
    .thin-scroll::-webkit-scrollbar-track{background:transparent}
    table.calendar {border-collapse: collapse; width: 100%;}
    table.calendar th, table.calendar td {border: 1px solid #e2e8f0; text-align: center; padding: 4px; font-size: 12px; cursor: pointer;}
    table.calendar td.marked {background-color:#bfdbfe; font-weight:bold;}
  </style>
</head>
<body class="h-full bg-slate-50 text-slate-900">
  <div id="app" class="h-full flex">
    <aside class="w-80 bg-white border-r border-slate-200 flex flex-col">
      <div class="p-4 border-b flex items-center justify-between">
        <h1 class="text-lg font-bold">FR7 일일 보고</h1>
      </div>
      <div class="p-3 border-b space-y-2">
        <button id="newReportBtn" class="w-full py-2 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700">+ 새 보고서</button>
      </div>
      <div id="reportList" class="flex-1 overflow-y-auto thin-scroll divide-y"></div>
      <div class="p-3 border-t">
        <h2 class="text-sm font-semibold mb-2">달력</h2>
        <div id="calendarContainer"></div>
      </div>
    </aside>

    <main class="flex-1 overflow-hidden">
      <div class="px-5 py-3 bg-white border-b flex items-center gap-3">
        <input id="reportTitle" class="text-lg font-bold flex-1 outline-none bg-transparent" placeholder="보고서 제목" />
        <div id="autosaveState" class="text-xs text-slate-500">저장 상태: -</div>
      </div>

      <div class="px-5 pt-4 bg-white border-b">
        <div class="flex gap-2 text-sm">
          <button data-tab="tab-summary" class="tab-btn px-3 py-2 rounded-t bg-slate-100 font-semibold">요약</button>
          <button data-tab="tab-detail" class="tab-btn px-3 py-2 rounded-t">세부</button>
        </div>
      </div>

      <section id="tab-summary" class="tab-pane p-5 overflow-y-auto thin-scroll h-[calc(100vh-136px)]">
        <div class="bg-white rounded-xl shadow p-4">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-semibold">오늘의 요약</h2>
            <button id="autoSummaryBtn" class="px-3 py-2 rounded bg-indigo-600 text-white text-sm hover:bg-indigo-700">세부 내용 요약하기</button>
          </div>
          <textarea id="summary" class="w-full min-h-40 rounded border p-3 text-sm" placeholder="세부 내용을 바탕으로 요약을 작성합니다"></textarea>
        </div>
      </section>

      <!-- 세부 -->
      <section id="tab-detail" class="tab-pane hidden p-5 overflow-y-auto thin-scroll h-[calc(100vh-136px)]">
        <div class="bg-white rounded-xl shadow p-4 mb-4">
          <h2 class="font-semibold mb-3">결과·측정</h2>
          <div class="grid grid-cols-2 gap-3 text-sm">
            <label class="space-y-1"><span>F (조리개)</span><input id="metricF" type="text" class="w-full rounded border p-2" placeholder="예: F4.0"/></label>
            <label class="space-y-1"><span>ISO</span><input id="metricISO" type="number" class="w-full rounded border p-2"/></label>
            <label class="space-y-1"><span>WB (화이트밸런스)</span><input id="metricWB" type="text" class="w-full rounded border p-2" placeholder="예: 3200K"/></label>
            <label class="space-y-1"><span>셔터</span><input id="metricShutter" type="text" class="w-full rounded border p-2" placeholder="예: 1/100"/></label>
            <label class="space-y-1"><span>FPS</span><input id="metricFPS" type="number" class="w-full rounded border p-2"/></label>
            <label class="space-y-1"><span>장면파일</span>
              <select id="metricScene" class="w-full rounded border p-2">
                <option value="">선택</option>
                <option>S-Cinetone</option>
                <option>Standard</option>
                <option>Still</option>
                <option>ITU709</option>
              </select>
            </label>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
            <label class="block"><span class="text-sm">Master Black</span>
              <input id="metricMB" type="range" min="-99" max="99" value="0" class="w-full">
            </label>
            <label class="block"><span class="text-sm">R Black</span>
              <input id="metricRB" type="range" min="-99" max="99" value="0" class="w-full">
            </label>
            <label class="block"><span class="text-sm">B Black</span>
              <input id="metricBB" type="range" min="-99" max="99" value="0" class="w-full">
            </label>
          </div>

          <div class="mt-4">
            <textarea id="metricMemo" class="w-full min-h-24 rounded border p-3 text-sm" placeholder="추가 메모 / 디테일 상황"></textarea>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const $=(s,el=document)=>el.querySelector(s);
    const $$=(s,el=document)=>Array.from(el.querySelectorAll(s));
    const LS_KEY='fr7-daily-reports-v6';
    let state={reports:[],currentId:null};

    function loadState(){try{const raw=localStorage.getItem(LS_KEY);if(raw){state=JSON.parse(raw);}}catch(e){}}
    function saveState(){localStorage.setItem(LS_KEY,JSON.stringify(state));const s=$('#autosaveState');if(s) s.textContent='저장 상태: '+new Date().toLocaleTimeString();renderCalendar();}

    function createEmptyReport(){const id='r_'+Math.random().toString(36).slice(2);return{id,title:new Date().toISOString().slice(0,10)+' FR7 보고',dateKST:new Date().toISOString().slice(0,10),summary:'',detail:{}};}
    function getCurrent(){return state.reports.find(r=>r.id===state.currentId)||null;}
    function setCurrent(id){state.currentId=id;saveState();renderReportList();renderEditor();}

    function renderReportList(){const box=$('#reportList');if(!box)return;box.innerHTML='';const sorted=[...state.reports].sort((a,b)=>(b.dateKST||'').localeCompare(a.dateKST||''));for(const r of sorted){const item=document.createElement('button');item.className='w-full text-left p-3 hover:bg-slate-50 '+(r.id===state.currentId?'bg-blue-50':'');item.innerHTML=`<div class="font-semibold truncate">${r.title}</div><div class="text-xs text-slate-500">${r.dateKST}</div>`;item.onclick=()=>setCurrent(r.id);box.appendChild(item);}}

    function renderEditor(){const r=getCurrent();if(!r)return;$('#reportTitle').value=r.title||'';$('#summary').value=r.summary||'';
      $('#metricF').value=r.detail.F||'';$('#metricISO').value=r.detail.ISO||'';$('#metricWB').value=r.detail.WB||'';$('#metricShutter').value=r.detail.Shutter||'';$('#metricFPS').value=r.detail.FPS||'';$('#metricScene').value=r.detail.Scene||'';
      $('#metricMB').value=r.detail.MB||0;$('#metricRB').value=r.detail.RB||0;$('#metricBB').value=r.detail.BB||0;$('#metricMemo').value=r.detail.Memo||'';}

    function autoSummarize(){
      const r=getCurrent(); if(!r) return;
      const d=r.detailFields||{};
      const parts=[];
      const kv=(k,v)=>{ if(v!=='' && v!=null) parts.push(`${k}: ${v}`); };
      kv('F', d.fAperture); kv('ISO', d.iso); kv('WB', d.wb); kv('셔터', d.shutter); kv('장면', d.sceneFile); kv('FPS', d.fps);
      if(d.masterBlack!=null || d.rBlack!=null || d.bBlack!=null){
        parts.push(`블랙 M/R/B: ${d.masterBlack??0}/${d.rBlack??0}/${d.bBlack??0}`);
      }
      if(d.memo){ parts.push(`메모: ${d.memo.replace(/\s+/g,' ').slice(0,120)}${d.memo.length>120?'…':''}`); }
      if(r.detail){ parts.push(r.detail.replace(/\s+/g,' ').slice(0,120)+(r.detail.length>120?'…':'')); }
      r.summary = parts.length? ('• '+parts.join('
• ')) : '';
      saveState();
      $('#summary').value=r.summary;
    }

    function renderCalendar(){const c=$('#calendarContainer');if(!c)return;const now=new Date();const y=now.getFullYear();const m=now.getMonth();const fd=new Date(y,m,1);const ld=new Date(y,m+1,0);let html='<table class="calendar"><thead><tr>';const days=['일','월','화','수','목','금','토'];for(const d of days)html+='<th>'+d+'</th>';html+='</tr></thead><tbody><tr>';for(let i=0;i<fd.getDay();i++)html+='<td></td>';for(let d=1;d<=ld.getDate();d++){const ds=y+'-'+String(m+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');const report=state.reports.find(r=>(r.dateKST||'').startsWith(ds));const cls=report?'marked':'';html+=`<td class="${cls}" data-date="${ds}">${d}</td>`;if((fd.getDay()+d)%7===0)html+='</tr><tr>'; }html+='</tr></tbody></table>';c.innerHTML=html;c.querySelectorAll('td.marked').forEach(td=>{td.addEventListener('click',()=>{const rep=state.reports.find(r=>(r.dateKST||'').startsWith(td.dataset.date));if(rep){setCurrent(rep.id);}});});}

    function bindInputs(){
      $('#reportTitle').addEventListener('input',()=>{ const r=getCurrent(); if(!r) return; r.title=$('#reportTitle').value; saveState(); });
      $('#summary').addEventListener('input',()=>{ const r=getCurrent(); if(!r) return; r.summary=$('#summary').value; saveState(); });
      $('#autoSummaryBtn').addEventListener('click',autoSummarize);
      $('#newReportBtn').addEventListener('click',()=>{ const r=createEmptyReport(); state.reports.push(r); setCurrent(r.id); });
      $$('.tab-btn').forEach(btn=>btn.addEventListener('click',()=>{ const id=btn.dataset.tab; $$('.tab-btn').forEach(b=>b.classList.remove('bg-slate-100','font-semibold')); btn.classList.add('bg-slate-100','font-semibold'); $$('.tab-pane').forEach(p=>p.classList.add('hidden')); $('#'+id).classList.remove('hidden'); }));

      const onText=(id,key)=>{ const el=$('#'+id); if(!el) return; el.addEventListener('input',()=>{ const r=getCurrent(); if(!r) return; r.detailFields=r.detailFields||{}; r.detailFields[key]=el.value; saveState(); }); };
      onText('fAperture','fAperture'); onText('iso','iso'); onText('wb','wb'); onText('shutter','shutter'); onText('sceneFile','sceneFile'); onText('fps','fps'); onText('memo','memo');
      const onRange=(id,key,disp)=>{ const el=$('#'+id); if(!el) return; el.addEventListener('input',()=>{ const r=getCurrent(); if(!r) return; r.detailFields=r.detailFields||{}; const val=parseInt(el.value,10)||0; r.detailFields[key]=val; const dEl=$('#'+disp); if(dEl) dEl.textContent=String(val); saveState(); }); };
      onRange('masterBlack','masterBlack','valMasterBlack'); onRange('rBlack','rBlack','valRBlack'); onRange('bBlack','bBlack','valBBlack');
    });
      $('#summary').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.summary=$('#summary').value;saveState();});
      $('#autoSummaryBtn').addEventListener('click',autoSummarize);
      $('#newReportBtn').addEventListener('click',()=>{const r=createEmptyReport();state.reports.push(r);setCurrent(r.id);});
      $$('.tab-btn').forEach(btn=>btn.addEventListener('click',()=>{const id=btn.dataset.tab;$$('.tab-btn').forEach(b=>b.classList.remove('bg-slate-100','font-semibold'));btn.classList.add('bg-slate-100','font-semibold');$$('.tab-pane').forEach(p=>p.classList.add('hidden'));$('#'+id).classList.remove('hidden');}));

      $('#metricF').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.F=$('#metricF').value;saveState();});
      $('#metricISO').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.ISO=$('#metricISO').value;saveState();});
      $('#metricWB').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.WB=$('#metricWB').value;saveState();});
      $('#metricShutter').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.Shutter=$('#metricShutter').value;saveState();});
      $('#metricFPS').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.FPS=$('#metricFPS').value;saveState();});
      $('#metricScene').addEventListener('change',()=>{const r=getCurrent();if(!r)return;r.detail.Scene=$('#metricScene').value;saveState();});
      $('#metricMB').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.MB=$('#metricMB').value;saveState();});
      $('#metricRB').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.RB=$('#metricRB').value;saveState();});
      $('#metricBB').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.BB=$('#metricBB').value;saveState();});
      $('#metricMemo').addEventListener('input',()=>{const r=getCurrent();if(!r)return;r.detail.Memo=$('#metricMemo').value;saveState();});
    }

    function boot(){loadState();if(!state.reports.length){const r=createEmptyReport();state.reports.push(r);state.currentId=r.id;saveState();}else if(!state.currentId){state.currentId=state.reports[0].id;}renderReportList();bindInputs();renderEditor();renderCalendar();}
    document.addEventListener('DOMContentLoaded',boot);
  </script>
</body>
</html>
